<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-mout/node_modules/mout/date/diff.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-mout">npmtest-mout (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-mout/node_modules/mout/date/diff.js</span></h1>
    <h2>
        
        Statements: <span class="metric">19.67% <small>(12 / 61)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 24)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">19.67% <small>(12 / 61)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-mout/node_modules/mout/date/</a> &#187; diff.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var totalDaysInMonth = require('./totalDaysInMonth');
var totalDaysInYear = require('./totalDaysInYear');
var convert = require('../time/convert');
&nbsp;
    /**
     * calculate the difference between dates (range)
     */
<span class="fstat-no" title="function not covered" >    function diff(start, end, unitName){</span>
        // sort the dates to make it easier to process (specially year/month)
<span class="cstat-no" title="statement not covered" >        if (start &gt; end) {</span>
<span class="cstat-no" title="statement not covered" >            var swap = start;</span>
<span class="cstat-no" title="statement not covered" >            start = end;</span>
<span class="cstat-no" title="statement not covered" >            end = swap;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var output;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (unitName === 'month') {</span>
<span class="cstat-no" title="statement not covered" >            output = getMonthsDiff(start, end);</span>
        } else <span class="cstat-no" title="statement not covered" >if (unitName === 'year'){</span>
<span class="cstat-no" title="statement not covered" >            output = getYearsDiff(start, end);</span>
        } else <span class="cstat-no" title="statement not covered" >if (unitName != null) {</span>
<span class="cstat-no" title="statement not covered" >            if (unitName === 'day') {</span>
                // ignore timezone difference because of daylight savings time
<span class="cstat-no" title="statement not covered" >                start = toUtc(start);</span>
<span class="cstat-no" title="statement not covered" >                end = toUtc(end);</span>
            }
<span class="cstat-no" title="statement not covered" >            output = convert(end - start, 'ms', unitName);</span>
        } else {
<span class="cstat-no" title="statement not covered" >            output = end - start;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return output;</span>
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function toUtc(d){</span>
        // we ignore timezone differences on purpose because of daylight
        // savings time, otherwise it would return fractional days/weeks even
        // if a full day elapsed. eg:
        // Wed Feb 12 2014 00:00:00 GMT-0200 (BRST)
        // Sun Feb 16 2014 00:00:00 GMT-0300 (BRT)
        // diff should be 4 days and not 4.041666666666667
<span class="cstat-no" title="statement not covered" >        return Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(),</span>
                        d.getHours(), d.getMinutes(), d.getSeconds(),
                        d.getMilliseconds());
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getMonthsDiff(start, end){</span>
<span class="cstat-no" title="statement not covered" >        return getElapsedMonths(start, end) +</span>
               getElapsedYears(start, end) * 12 +
               getFractionalMonth(start, end);
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getYearsDiff(start, end){</span>
<span class="cstat-no" title="statement not covered" >        var elapsedYears = getElapsedYears(start, end);</span>
<span class="cstat-no" title="statement not covered" >        return elapsedYears + getFractionalYear(start, end, elapsedYears);</span>
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getElapsedMonths(start, end){</span>
<span class="cstat-no" title="statement not covered" >        var monthDiff = end.getMonth() - start.getMonth();</span>
<span class="cstat-no" title="statement not covered" >        if (monthDiff &lt; 0) {</span>
<span class="cstat-no" title="statement not covered" >            monthDiff += 12;</span>
        }
        // less than a full month
<span class="cstat-no" title="statement not covered" >        if (start.getDate() &gt; end.getDate()) {</span>
<span class="cstat-no" title="statement not covered" >            monthDiff -= 1;</span>
        }
<span class="cstat-no" title="statement not covered" >        return monthDiff;</span>
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getElapsedYears(start, end){</span>
<span class="cstat-no" title="statement not covered" >        var yearDiff = end.getFullYear() - start.getFullYear();</span>
        // less than a full year
<span class="cstat-no" title="statement not covered" >        if (start.getMonth() &gt; end.getMonth()) {</span>
<span class="cstat-no" title="statement not covered" >            yearDiff -= 1;</span>
        }
<span class="cstat-no" title="statement not covered" >        return yearDiff;</span>
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getFractionalMonth(start, end){</span>
<span class="cstat-no" title="statement not covered" >        var fractionalDiff = 0;</span>
<span class="cstat-no" title="statement not covered" >        var startDay = start.getDate();</span>
<span class="cstat-no" title="statement not covered" >        var endDay = end.getDate();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (startDay !== endDay) {</span>
<span class="cstat-no" title="statement not covered" >            var startTotalDays = totalDaysInMonth(start);</span>
<span class="cstat-no" title="statement not covered" >            var endTotalDays = totalDaysInMonth(end);</span>
<span class="cstat-no" title="statement not covered" >            var totalDays;</span>
<span class="cstat-no" title="statement not covered" >            var daysElapsed;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (startDay &gt; endDay) {</span>
                // eg: Jan 29 - Feb 27 (29 days elapsed but not a full month)
<span class="cstat-no" title="statement not covered" >                var baseDay = startTotalDays - startDay;</span>
<span class="cstat-no" title="statement not covered" >                daysElapsed = endDay + baseDay;</span>
                // total days should be relative to 1st day of next month if
                // startDay &gt; endTotalDays
<span class="cstat-no" title="statement not covered" >                totalDays = (startDay &gt; endTotalDays)?</span>
                    endTotalDays + baseDay + 1 : startDay + baseDay;
            } else {
                // fractional is only based on endMonth eg: Jan 12 - Feb 18
                // (6 fractional days, 28 days until next full month)
<span class="cstat-no" title="statement not covered" >                daysElapsed = endDay - startDay;</span>
<span class="cstat-no" title="statement not covered" >                totalDays = endTotalDays;</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            fractionalDiff = daysElapsed / totalDays;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return fractionalDiff;</span>
    }
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >    function getFractionalYear(start, end, elapsedYears){</span>
<span class="cstat-no" title="statement not covered" >        var base = elapsedYears?</span>
            new Date(end.getFullYear(), start.getMonth(), start.getDate()) :
            start;
<span class="cstat-no" title="statement not covered" >        var elapsedDays = diff(base, end, 'day');</span>
<span class="cstat-no" title="statement not covered" >        return elapsedDays / totalDaysInYear(end);</span>
    }
&nbsp;
&nbsp;
    module.exports = diff;
&nbsp;
&nbsp;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 20 2017 19:41:36 GMT+0000 (UTC)</div>
</div>
</body>
</html>
